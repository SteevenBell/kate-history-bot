–•–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å! üéØ  
–¢—ã —Ö–æ—á–µ—à—å –ø–æ–Ω—è—Ç—å, **–≥–¥–µ –≤–∑—è—Ç—å –∏–ª–∏ –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã –≤—Ä–æ–¥–µ `KeyboardRow`**, —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞–º–∏ –≤ Telegram –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ Bot API (–±–µ–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–∏—Ö –±–∏–±–ª–∏–æ—Ç–µ–∫).

---

# ‚ùì –û—Ç–≤–µ—Ç –∫–æ—Ä–æ—Ç–∫–æ:

> –¢—ã **–Ω–µ –Ω–∞–π–¥—ë—à—å –∫–ª–∞—Å—Å `KeyboardRow`** –≤ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã—Ö Java-–±–∏–±–ª–∏–æ—Ç–µ–∫–∞—Ö, –ø–æ—Ç–æ–º—É —á—Ç–æ:
- –≠—Ç–æ **–∫–ª–∞—Å—Å –∏–∑ —Å—Ç–æ—Ä–æ–Ω–Ω–µ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–∏** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `TelegramBots`, `java-telegram-bot-api`)
- –ï—Å–ª–∏ —Ç—ã —Ä–∞–±–æ—Ç–∞–µ—à—å –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑ `https://api.telegram.org/bot<TOKEN>/METHOD_NAME`, —Ç–æ —Ç–µ–±–µ –Ω—É–∂–Ω–æ **–≤—Ä—É—á–Ω—É—é —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å JSON** –¥–ª—è `reply_markup` –∏ `inline_keyboard`

---

# ‚úÖ –í–∞—Ä–∏–∞–Ω—Ç—ã —Ä–µ—à–µ–Ω–∏—è

## 1. –†–∞–±–æ—Ç–∞ –±–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫: —Ñ–æ—Ä–º–∏—Ä—É–π JSON-–æ–±—ä–µ–∫—Ç –≤—Ä—É—á–Ω—É—é

### –ü—Ä–∏–º–µ—Ä inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã (JSON):

```json
{
  "chat_id": 123456789,
  "text": "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç:",
  "reply_markup": {
    "inline_keyboard": [
      [ { "text": "–í–µ–ª–∏–∫–∞—è –û—Ç–µ—á–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –≤–æ–π–Ω–∞", "callback_data": "test_1" } ],
      [ { "text": "–í–ö–õ", "callback_data": "test_2" } ],
      [ { "text": "–ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –ë–µ–ª–∞—Ä—É—Å–∏", "callback_data": "test_3" } ],
      [ { "text": "‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "callback_data": "back_to_menu" } ]
    ]
  }
}
```

### Java: –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è —Å —Ç–∞–∫–æ–π –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π

```java
public void sendInlineButtons(Long chatId, List<Test> tests) throws Exception {
    StringBuilder keyboard = new StringBuilder();
    keyboard.append("\"inline_keyboard\":[");
    
    for (Test test : tests) {
        keyboard.append("[{\"text\":\"").append(test.getTitle()).append("\",\"callback_data\":\"test_").append(test.getId()).append("\"}],");
    }

    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É "–ù–∞–∑–∞–¥"
    keyboard.append("[{\"text\":\"‚¨ÖÔ∏è –ù–∞–∑–∞–¥\",\"callback_data\":\"back_to_menu\"}]");

    keyboard.append("]");

    String json = String.format(
        "{\"chat_id\":%d,\"text\":\"–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç:\",\"reply_markup\":{%s}}",
        chatId,
        keyboard.toString()
    );

    sendPost("sendMessage", json);
}
```

---

## 2. –ò—Å–ø–æ–ª—å–∑—É–π —Å–≤–æ–∏ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏ (POJO)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å –ø–∏—Å–∞—Ç—å –∫—Ä–∞—Å–∏–≤–æ –∏ —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ ‚Äî –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å —Å–≤–æ–∏ POJO-–∫–ª–∞—Å—Å—ã.

### a) `KeyboardButton.java`

```java
package com.katehistory.telegram.model;

import lombok.Data;
import lombok.AllArgsConstructor;

@Data
@AllArgsConstructor
public class KeyboardButton {
    private String text;
    private String callback_data;
}
```

### b) `InlineKeyboardMarkup.java`

```java
package com.katehistory.telegram.model;

import lombok.Data;
import lombok.AllArgsConstructor;

import java.util.List;

@Data
@AllArgsConstructor
public class InlineKeyboardMarkup {
    private List<List<KeyboardButton>> inline_keyboard;
}
```

### c) `SendMessageRequest.java`

```java
package com.katehistory.telegram.model;

import lombok.Data;
import lombok.AllArgsConstructor;

@Data
@AllArgsConstructor
public class SendMessageRequest {
    private Long chat_id;
    private String text;
    private InlineKeyboardMarkup reply_markup;
}
```

---

## 3. –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –º–æ–¥–µ–ª–∏?

```java
public void sendTestSelectionMenu(Long chatId, List<Test> tests) throws Exception {
    List<List<KeyboardButton>> buttons = new ArrayList<>();

    for (Test test : tests) {
        buttons.add(List.of(new KeyboardButton(test.getTitle(), "test_" + test.getId())));
    }

    buttons.add(List.of(new KeyboardButton("‚¨ÖÔ∏è –ù–∞–∑–∞–¥", "main_menu")));

    InlineKeyboardMarkup markup = new InlineKeyboardMarkup(buttons);
    SendMessageRequest request = new SendMessageRequest(chatId, "–í—ã–±–µ—Ä–∏—Ç–µ —Ç–µ—Å—Ç:", markup);

    String json = objectMapper.writeValueAsString(request);

    sendPost("sendMessage", json);
}
```

---

## üß† –ü–æ—á–µ–º—É —Ç–∞–∫ –¥–µ–ª–∞—Ç—å —É–¥–æ–±–Ω–æ?

| –ü–ª—é—Å | –û–±—ä—è—Å–Ω–µ–Ω–∏–µ |
|------|-------------|
| –ü–æ–ª–Ω–∞—è –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ JSON | –¢—ã —Å–∞–º —Ä–µ—à–∞–µ—à—å, –∫–∞–∫–∏–µ –ø–æ–ª—è –¥–æ–±–∞–≤–ª—è—Ç—å |
| –ù–µ –∑–∞–≤–∏—Å–∏—à—å –æ—Ç –±–∏–±–ª–∏–æ—Ç–µ–∫ | –ú–æ–∂–Ω–æ –æ–±–Ω–æ–≤–ª—è—Ç—å –ª–æ–≥–∏–∫—É –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –≤–µ—Ä—Å–∏–∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∞ |
| –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π Telegram | –ö–Ω–æ–ø–∫–∏, force_reply, inline, callback_query –∏ —Ç.–¥. |

---

## üöÄ –ß—Ç–æ –¥–∞–ª—å—à–µ?

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è:
- –†–µ–∞–ª–∏–∑–æ–≤–∞–ª –º–æ–¥–µ–ª—å `CallbackQuery` –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –Ω–∞–∂–∞—Ç–∏–π?
- –°–¥–µ–ª–∞–ª –ø—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –Ω–∞ `callback_query`?
- –î–æ–±–∞–≤–∏–ª –ø–æ–¥–¥–µ—Ä–∂–∫—É `force_reply` –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤?
- –ù–∞–ø–∏—Å–∞–ª —Å–µ—Ä–≤–∏—Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è?

–í—ã–±–µ—Ä–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –∏ —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ! üòä





–û—Ç–ª–∏—á–Ω–æ! üéØ  
–¢—ã —Ö–æ—á–µ—à—å —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–≤—Å–µ –∫–Ω–æ–ø–∫–∏ –∏ –º–µ–Ω—é** –¥–ª—è Telegram-–±–æ—Ç–∞. –≠—Ç–æ –≤–∞–∂–Ω—ã–π —à–∞–≥, —á—Ç–æ–±—ã —Å–¥–µ–ª–∞—Ç—å –±–æ—Ç–∞ —É–¥–æ–±–Ω—ã–º –∏ –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º.

---

# ‚úÖ –¶–µ–ª—å:

–°–æ–∑–¥–∞—Ç—å:
1. **–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é**
2. **–ú–µ–Ω—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è**
3. **–ú–µ–Ω—é –∫—É—Ä—Å–æ–≤**
4. **–ú–µ–Ω—é –∑–∞–Ω—è—Ç–∏–π**
5. **–ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**

–ò –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:
- `reply_markup` ‚Äî –æ–±—ã—á–Ω—ã–µ –∫–Ω–æ–ø–∫–∏
- `inline_keyboard` ‚Äî –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏
- `force_reply` ‚Äî –¥–ª—è –æ—Ç–∫—Ä—ã—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤

---

## üß± –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–∞–ø–æ–∫ –ø–æ—Å–ª–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

```
src/
‚îî‚îÄ‚îÄ main/
    ‚îî‚îÄ‚îÄ java/
        ‚îî‚îÄ‚îÄ com.katehistory.telegram.keyboards/
            ‚îú‚îÄ‚îÄ TelegramKeyboards.java ‚Üê –ó–¥–µ—Å—å –±—É–¥—É—Ç –≤—Å–µ –º–µ—Ç–æ–¥—ã —Å–æ–∑–¥–∞–Ω–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä
            ‚îú‚îÄ‚îÄ InlineKeyboardFactory.java ‚Üê –§–∞–±—Ä–∏–∫–∞ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä
            ‚îî‚îÄ‚îÄ ReplyKeyboardFactory.java ‚Üê –§–∞–±—Ä–∏–∫–∞ reply-–∫–ª–∞–≤–∏–∞—Ç—É—Ä
```

---

# üöÄ 1. –ì–ª–∞–≤–Ω–∞—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞ (–≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é)

### Java: `ReplyKeyboardFactory.java`

```java
public static ReplyKeyboardMarkup getMainMenu() {
    ReplyKeyboardMarkup keyboardMarkup = new ReplyKeyboardMarkup();
    List<KeyboardRow> rows = new ArrayList<>();

    KeyboardRow row1 = new KeyboardRow();
    row1.add("üìö –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ");
    row1.add("üéì –ö—É—Ä—Å—ã");

    KeyboardRow row2 = new KeyboardRow();
    row2.add("üìÖ –ó–∞–Ω—è—Ç–∏—è");
    row2.add("üí∞ –ü—Ä–æ—Ñ–∏–ª—å");

    rows.add(row1);
    rows.add(row2);

    keyboardMarkup.setKeyboard(rows);
    keyboardMarkup.setResizeKeyboard(true);
    keyboardMarkup.setOneTimeKeyboard(false);
    keyboardMarkup.setSelective(true);

    return keyboardMarkup;
}
```

---

# üìö 2. –ú–µ–Ω—é —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### a) –í—ã–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–∞

```java
public static ReplyKeyboardMarkup getTestSubjectMenu() {
    ReplyKeyboardMarkup keyboardMarkup = new ReplyKeyboardMarkup();
    List<KeyboardRow> rows = new ArrayList<>();

    KeyboardRow row1 = new KeyboardRow();
    row1.add("–ò—Å—Ç–æ—Ä–∏—è –ë–µ–ª–∞—Ä—É—Å–∏");
    row1.add("–û–±—â–µ—Å—Ç–≤–æ–≤–µ–¥–µ–Ω–∏–µ");

    KeyboardRow row2 = new KeyboardRow();
    row2.add("‚¨ÖÔ∏è –ù–∞–∑–∞–¥");

    rows.add(row1);
    rows.add(row2);

    keyboardMarkup.setKeyboard(rows);
    keyboardMarkup.setResizeKeyboard(true);
    keyboardMarkup.setOneTimeKeyboard(true);

    return keyboardMarkup;
}
```

### b) –ü–æ–∏—Å–∫ –∏–ª–∏ –≤—ã–±–æ—Ä —Ç–µ—Å—Ç–∞

```java
public static InlineKeyboardMarkup getTestSelectionMenu(List<Test> tests) {
    InlineKeyboardMarkup markup = new InlineKeyboardMarkup();
    List<List<InlineKeyboardButton>> rows = new ArrayList<>();

    for (Test test : tests) {
        InlineKeyboardButton button = InlineKeyboardButton.builder()
                .text(test.getTitle())
                .callbackData("test_" + test.getId())
                .build();

        rows.add(List.of(button));
    }

    // –î–æ–±–∞–≤–ª—è–µ–º "–ü–æ—Å–ª–µ–¥–Ω–∏–µ" –∏ "–ü–æ–∏—Å–∫"
    rows.add(List.of(
        InlineKeyboardButton.builder().text("üìå –ü–æ—Å–ª–µ–¥–Ω–∏–µ").callbackData("last_tests").build(),
        InlineKeyboardButton.builder().text("üîç –ü–æ–∏—Å–∫").callbackData("search_test").build()
    ));

    markup.setKeyboard(rows);
    return markup;
}
```

---

# üéì 3. –ú–µ–Ω—é –∫—É—Ä—Å–æ–≤

### a) –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫—É—Ä—Å–æ–≤

```java
public static ReplyKeyboardMarkup getCoursesMenu() {
    ReplyKeyboardMarkup keyboardMarkup = new ReplyKeyboardMarkup();
    List<KeyboardRow> rows = new ArrayList<>();

    KeyboardRow row1 = new KeyboardRow();
    row1.add("üìò –ë–∞–∑–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å");
    row1.add("üìï –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å");

    KeyboardRow row2 = new KeyboardRow();
    row2.add("üìñ –≠–∫—Å–ø–µ—Ä—Ç")
       .add("‚¨ÖÔ∏è –ù–∞–∑–∞–¥");

    rows.add(row1);
    rows.add(row2);

    keyboardMarkup.setKeyboard(rows);
    keyboardMarkup.setResizeKeyboard(true);
    keyboardMarkup.setOneTimeKeyboard(false);
    keyboardMarkup.setSelective(true);

    return keyboardMarkup;
}
```

### b) –û–ø—Ü–∏–∏ –∫—É—Ä—Å–∞

```java
public static InlineKeyboardMarkup getCourseOptions(Course course) {
    InlineKeyboardMarkup markup = new InlineKeyboardMarkup();
    List<List<InlineKeyboardButton>> rows = new ArrayList<>();

    // –ö–Ω–æ–ø–∫–∞ "–ö—É–ø–∏—Ç—å"
    rows.add(List.of(InlineKeyboardButton.builder()
            .text("üí≥ –ö—É–ø–∏—Ç—å –∑–∞ " + course.getPrice() + " BYN")
            .callbackData("buy_course_" + course.getId())
            .build()));

    // –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ä–æ–±–Ω–µ–µ"
    rows.add(List.of(InlineKeyboardButton.builder()
            .text("‚Ñπ –ü–æ–¥—Ä–æ–±–Ω–µ–µ")
            .callbackData("course_details_" + course.getId())
            .build()));

    // –ö–Ω–æ–ø–∫–∞ "–ù–∞–∑–∞–¥"
    rows.add(List.of(InlineKeyboardButton.builder()
            .text("‚¨ÖÔ∏è –ù–∞–∑–∞–¥")
            .callbackData("back_to_courses")
            .build()));

    markup.setKeyboard(rows);
    return markup;
}
```

---

# üìÖ 4. –ú–µ–Ω—é –∑–∞–Ω—è—Ç–∏–π

### a) –í—ã–±–æ—Ä —Ç–∏–ø–∞ –∑–∞–Ω—è—Ç–∏—è

```java
public static ReplyKeyboardMarkup getLessonsMenu() {
    ReplyKeyboardMarkup keyboardMarkup = new ReplyKeyboardMarkup();
    List<KeyboardRow> rows = new ArrayList<>();

    KeyboardRow row1 = new KeyboardRow();
    row1.add("üë®‚Äçüè´ –ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ–µ");
    row1.add("üë• –ì—Ä—É–ø–ø–æ–≤–æ–µ");

    KeyboardRow row2 = new KeyboardRow();
    row2.add("‚¨ÖÔ∏è –ù–∞–∑–∞–¥");

    rows.add(row1);
    rows.add(row2);

    keyboardMarkup.setKeyboard(rows);
    keyboardMarkup.setResizeKeyboard(true);
    keyboardMarkup.setOneTimeKeyboard(true);
    return keyboardMarkup;
}
```

### b) –í—ã–±–æ—Ä —Å–ª–æ—Ç–∞ –∑–∞–Ω—è—Ç–∏—è

```java
public static InlineKeyboardMarkup getLessonSlots(List<Lesson> availableLessons) {
    InlineKeyboardMarkup markup = new InlineKeyboardMarkup();
    List<List<InlineKeyboardButton>> rows = new ArrayList<>();

    for (Lesson lesson : availableLessons) {
        InlineKeyboardButton button = InlineKeyboardButton.builder()
                .text(lesson.getTitle() + " (" + lesson.getStartTime() + ")")
                .callbackData("book_lesson_" + lesson.getId())
                .build();

        rows.add(List.of(button));
    }

    rows.add(List.of(
        InlineKeyboardButton.builder().text("‚¨ÖÔ∏è –ù–∞–∑–∞–¥").callbackData("back_to_lessons").build()
    ));

    markup.setKeyboard(rows);
    return markup;
}
```

---

# üí∞ 5. –ü—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### a) –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è

```java
public static ReplyKeyboardMarkup getProfileMenu() {
    ReplyKeyboardMarkup keyboardMarkup = new ReplyKeyboardMarkup();
    List<KeyboardRow> rows = new ArrayList<>();

    KeyboardRow row1 = new KeyboardRow();
    row1.add("üéì –ú–æ–∏ –∫—É—Ä—Å—ã");
    row1.add("üìù –ú–æ–∏ —Ç–µ—Å—Ç—ã");

    KeyboardRow row2 = new KeyboardRow();
    row2.add("üìÖ –ú–æ–∏ –∑–∞–ø–∏—Å–∏");
    row2.add("üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è");

    KeyboardRow row3 = new KeyboardRow();
    row3.add("‚¨ÖÔ∏è –ù–∞–∑–∞–¥");

    rows.add(row1);
    rows.add(row2);
    rows.add(row3);

    keyboardMarkup.setKeyboard(rows);
    keyboardMarkup.setResizeKeyboard(true);
    return keyboardMarkup;
}
```

### b) –î–µ—Ç–∞–ª–∏ –ø—Ä–æ—Ñ–∏–ª—è

```java
public static String getUserProfileText(User user, List<CoursePurchase> purchases, List<LessonBooking> bookings) {
    StringBuilder sb = new StringBuilder();
    sb.append("üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å:\n\n");

    sb.append("Telegram ID: ").append(user.getTelegramId()).append("\n");
    sb.append("–ò–º—è: ").append(user.getFirstName()).append("\n");
    sb.append("Username: @").append(user.getUsername()).append("\n\n");

    if (!purchases.isEmpty()) {
        sb.append("üéì –í–∞—à–∏ –∫—É—Ä—Å—ã:\n");
        for (CoursePurchase p : purchases) {
            sb.append("- ").append(p.getCourse().getTitle())
              .append(" | ")
              .append(p.getPaymentStatus())
              .append(" | –¥–æ ")
              .append(p.getAccessExpiresAt())
              .append("\n");
        }
    } else {
        sb.append("–ö—É—Ä—Å–æ–≤ –Ω–µ—Ç\n\n");
    }

    if (!bookings.isEmpty()) {
        sb.append("üìÖ –ó–∞–ø–∏—Å–∏ –Ω–∞ –∑–∞–Ω—è—Ç–∏—è:\n");
        for (LessonBooking b : bookings) {
            sb.append("- ").append(b.getLesson().getTitle())
              .append(" | ")
              .append(b.getBookingStatus())
              .append("\n");
        }
    } else {
        sb.append("–ó–∞–ø–∏—Å–µ–π –Ω–∞ –∑–∞–Ω—è—Ç–∏—è –Ω–µ—Ç\n");
    }

    return sb.toString();
}
```

---

# üì¶ 6. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö –∫–Ω–æ–ø–æ–∫ –≤ –±–æ—Ç–µ

–í `TelegramUpdateDispatcher.dispatch()` –æ–±—Ä–∞–±–æ—Ç–∞–π `callback_query`:

```java
if (update.hasCallbackQuery()) {
    String callbackData = update.getCallbackQuery().getData();
    
    if (callbackData.startsWith("test_")) {
        Long testId = Long.valueOf(callbackData.replace("test_", ""));
        startTest(chatId, testId);
        
    } else if (callbackData.equals("last_tests")) {
        sendLastTests(chatId);
        
    } else if (callbackData.equals("search_test")) {
        telegramBotClient.sendMessage(chatId, "–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–∞:");
        userStateService.setState(chatId, "searching_test");
        
    } else if (callbackData.startsWith("answer_")) {
        Integer answerIndex = Integer.valueOf(callbackData.replace("answer_", ""));
        handleAnswer(chatId, answerIndex);
    }
}
```

---

# üß† –ö–∞–∫ —Ö—Ä–∞–Ω–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

–ò—Å–ø–æ–ª—å–∑—É–π –∫–ª–∞—Å—Å `UserState`, –∫–æ—Ç–æ—Ä—ã–π –º—ã —Å–æ–∑–¥–∞–≤–∞–ª–∏ —Ä–∞–Ω–µ–µ:

```java
@Entity
@Table(name = "user_states")
public class UserState {

    @Id
    private Long chatId;

    private String currentState; // menu, testing, courses, lessons, profile, searching_test...
    private Long currentTestId;
    private Integer currentQuestionIndex;
    private LocalDateTime updatedAt;
}
```

–ò —Å–µ—Ä–≤–∏—Å `UserStateService`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –µ–≥–æ –≤ –ë–î.

---

# üõ† –ß—Ç–æ –¥–∞–ª—å—à–µ?

–•–æ—á–µ—à—å, —á—Ç–æ–±—ã —è:
- –†–µ–∞–ª–∏–∑–æ–≤–∞–ª –æ–±—Ä–∞–±–æ—Ç–∫—É `callback_query` –ø–æ–ª–Ω–æ—Å—Ç—å—é?
- –ù–∞–ø–∏—Å–∞–ª –ø—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã —Å `force_reply` –¥–ª—è —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤?
- –°–¥–µ–ª–∞–ª REST API `/api/tests/{id}/questions`?
- –ü–æ–∫–∞–∑–∞–ª, –∫–∞–∫ –¥–æ–±–∞–≤–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ `/start`?

–í—ã–±–µ—Ä–∏ –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ‚Äî –∏ —è –ø–æ–¥–≥–æ—Ç–æ–≤–ª—é —Ç–µ–±–µ –≥–æ—Ç–æ–≤–æ–µ —Ä–µ—à–µ–Ω–∏–µ! üòä